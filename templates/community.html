<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ app_name }} - YourToolQuizz</title>
<style>
/* --- Estilos (los tuyos + algunos ajustes) --- */
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
body { display: flex; height: 100vh; background: #fafafa; }
/* Sidebar */
.group-sidebar { width: 320px; background: #fff; border-right: 1px solid #e5e7eb; display: flex; flex-direction: column; }
.group-header { padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; }
.group-logo { width: 80px; height: 80px; border-radius: 20px; background: white; margin: 0 auto 15px; border: 4px solid white; }
.group-name { font-size: 20px; font-weight: 700; margin-bottom: 5px; }
.group-members { font-size: 14px; opacity: 0.9; }
.chat-area { flex: 1; display: flex; flex-direction: column; background: #f7f7f7; }
.chat-header { padding: 20px 25px; background: white; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; }
.chat-title { font-size: 18px; font-weight: 600; color: #111827; }
.user-status { font-size: 14px; color: #10b981; display: flex; align-items: center; gap: 5px; }
.chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 16px; }
/* Mensajes */
.role-message { align-self: flex-start; background: #fef3c7; border-left: 4px solid #f59e0b; color: #92400e; padding: 12px 16px; border-radius: 12px; max-width: 80%; }
.role-badge { font-size: 11px; font-weight: 700; text-transform: uppercase; color: #b45309; margin-bottom: 4px; }
.admin-message { align-self: flex-start; background: white; border-radius: 16px; border: 2px solid #3b82f6; padding: 16px; max-width: 80%; }
.admin-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.admin-badge { background: #3b82f6; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; }
.admin-name { font-weight: 600; color: #111827; }
.user-message { align-self: flex-end; background: #3b82f6; color: white; border-radius: 16px; padding: 12px 16px; max-width: 70%; }
.user-name { font-size: 12px; opacity: 0.9; margin-bottom: 4px; }
.message-content { line-height: 1.5; }
.poll-message { background: white; border-radius: 16px; border: 2px solid #10b981; padding: 16px; max-width: 80%; align-self: flex-start; }
.poll-question { font-weight: 600; margin-bottom: 12px; color: #111827; }
.poll-options { display: flex; flex-direction: column; gap: 8px; }
.poll-option { padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
.poll-option:hover { background: #f3f4f6; }
.poll-option.selected { background: #10b981; color: white; border-color: #10b981; }
/* Input */
.chat-input { padding: 20px; background: white; border-top: 1px solid #e5e7eb; display: flex; gap: 12px; }
.chat-input input { flex: 1; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 24px; font-size: 14px; outline: none; }
.chat-input input:focus { border-color: #3b82f6; }
.chat-input button { padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 24px; cursor: pointer; font-weight: 600; }
.chat-input button:hover { background: #2563eb; }
</style>
</head>
<body>

<!-- Sidebar -->
<div class="group-sidebar">
  <div class="group-header">
    <div class="group-logo"></div>
    <div class="group-name">{{ community.name }}</div>
    <div class="group-members">{{ member_count }} miembros</div>
  </div>
</div>

<!-- Chat -->
<div class="chat-area">
  <div class="chat-header">
    <div class="chat-title">Chat de {{ community.name }}</div>
    <div class="user-status">
      <span>●</span> {{ current_user.name }} - {{ "Administrador" if current_user.is_admin else "Usuario" }}
    </div>
  </div>

  <div class="chat-messages" id="messages">
    {% for msg in messages %}
      {% set role = "owner" if msg.user.is_owner else "admin" if msg.user.is_admin else "user" %}
      {% if msg.message_type == 'poll' %}
        <div class="poll-message">
          <div class="poll-question">{{ msg.content }}</div>
          <div class="poll-options">
            {% for opt in msg.extra_data.options %}
              <div class="poll-option">{{ opt }}</div>
            {% endfor %}
          </div>
        </div>
      {% elif role in ['owner','admin'] %}
        <div class="role-message">
          <div class="role-badge">{{ role.upper() }}</div>
          <div class="admin-name">{{ msg.user.name }}</div>
          <div class="message-content">{{ msg.content }}</div>
        </div>
      {% else %}
        <div class="user-message">
          <div class="user-name">{{ msg.user.name }}</div>
          <div class="message-content">{{ msg.content }}</div>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <div class="chat-input">
    <input id="message-input" type="text" placeholder="Escribe un mensaje">
    <button id="send-btn">Enviar</button>
  </div>
</div>

<!-- Datos JS -->
<!-- Datos JS -->
<div id="chat-container" 
     data-community-id="{{ community.id }}" 
     data-user-id="{{ current_user.id }}" 
     data-user-name="{{ current_user.name }}" 
     data-is-admin="{{ current_user.role == 'admin' }}" 
     data-is-owner="{{ current_user.is_owner }}">
</div>

<!-- Mensajes históricos ocultos para JS -->
<div id="historical-messages" style="display:none;">
    {{ historical_messages | tojson }}
</div>

<script src="{{ url_for('static', filename='java/socket.io.min.js') }}"></script>
<script src="{{ url_for('static', filename='java/community-chat.js') }}"></script>


</body>
</html>